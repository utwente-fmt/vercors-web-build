
<!DOCTYPE HTML>
<!--
VerCors Tool --- Formal Methods and Tools Group (EWI)
University of Twente, Enschede, The Netherlands
-->
<html lang="en">
    <head>
        <title>Witnesses: Recursive tree 3 (magic wand) Â· VerCors Tool FMT | UTwente </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta name="description" content="">
        <meta name="keywords" content="">

        <link rel="stylesheet" href="/css/codemirror.css">
        <link rel="stylesheet" href="/css/codemirror-monokai.css">
        <link rel="stylesheet" href="/css/highlight/default.css">
        <link rel="stylesheet" href="/css/datatables.min.css">
        <link rel="stylesheet" href="/css/style.css">

        <script src="/js/jquery.min.js"></script>
        <script src="/js/highlight.pack.js"></script>
        <script src="/js/codemirror.js"></script>
        <script src="/js/datatables.min.js"></script>
        <script src="/js/vercorsonline.js"></script>
        <script src="/js/init.js"></script>

        <!--<script type="text/javascript">
            hljs.initHighlightingOnLoad();
        </script>-->
    </head>
    <body class="no-sidebar">
        <div id="header">
            <h1 id="logo" style="position: relative">
                <span id="hamburger" onclick="document.querySelector('#nav').classList.toggle('open')" class="fa fa-bars"></span>
                <a href="/">The VerCors Verifier</a>
            </h1>
            <nav id="nav">
                <ul>
                    <li>
                        <a href="/wiki/#introduction">Getting Started</a>
                        <ul>
                            <li><a href="/wiki/#introduction">Introduction</a></li>
                            <li><a href="/wiki/#installing-and-running-vercors">Installation Guide</a></li>
                            <li><a href="/wiki/">Tutorial</a></li>
                            <li>
                                <a href="//github.com/utwente-fmt/vercors/issues" target="_blank">
                                    Issue Tracker
                                    <span class="fa fa-external-link" style="font-size: 10pt"></span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li><a href="/try_online/examples/">Showcases</a></li>
                    <li><a href="/news/">News</a></li>
                    <li><a href="/publications/">Publications</a></li>
                    <li>
                        <a href="/about/">About</a>
                        <ul>
                            <li><a href="/about/#Team">VerCors Team</a></li>
                            <li><a href="/about/#Contact">Contact</a></li>
                            <li><a href="/about/#Credits">Credits</a></li>
                            <li><a href="/license/">License</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="container">
                <div id="banner">
                    <div class="container">
                        <section>
                            
                            <p>
                                <a href="//github.com/utwente-fmt/vercors" class="button alt" target="_blank">
                                    View on Github
                                </a>
                                <a href="/try_online/" class="button alt">Try VerCors Online</a>
                            </p>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        
<div id="main" class="style1 wrapper">
    <div class="container">
        
    <div class="example-view">
        <h1>Witnesses: Recursive tree 3 (magic wand)</h1>
        <p>This file demonstrates how a magic wand can be used to prove that the deletion of a node from a binary search tree is sound.</p>

        <h3>General Information</h3>
        <ul>
            <li><strong>Backend</strong>: Silicon</li>
            <li><strong>Language</strong>: Java</li>
            <li><strong>Features</strong>: Sequences, Witnesses, Trees, Magic wands</li>
            <li><strong>Path to Example File</strong>: witnesses/TreeWandSilver.java</li>
            <li><strong>Should Verify</strong>: Yes</li>
            <li><strong>Date</strong>: 2017-06-21</li>
            <li><strong>Lines of Code</strong>: 101 (comments not included)</li>
            <li><strong>Lines of Specification</strong>: 67 (66.3% of total)</li>
            
                <li><strong>Computation Time</strong>: 78.0 seconds</li>
            
        </ul>

        
<div class="verification-container">
    
    <div class="verification-widget verification-non-plain" >
        <div style="position: relative">
            <textarea name="examplecode" rows="20" data-code-mirror="true">// -*- tab-width:2 ; indent-tabs-mode:nil -*-
//:: cases TreeWandSilver
// suite puptol
// tools silicon
/*
    This file demonstrates how a magic wand can be used to prove
    that the deletion of a node from a binary search tree is sound.
    
    vct --silver=silicon TreeWandSilver.java

    The expected result is Pass.
*/

final class Tree {
  public int data;
  public Tree left;
  public Tree right;
  
  /*@ public resource state()=Perm(data,write)**
      Perm(left,write)**Perm(right,write)**left-&gt;state()**right-&gt;state();
  @*/

  /*@
    requires t-&gt;state();
    public static seq&lt;int&gt; tolist(Tree t)=(t==null)?seq&lt;int&gt;{}:
        \unfolding t.state() \in tolist(t.left) + seq&lt;int&gt;{t.data} + tolist(t.right);
    @*/

  /*@
    public inline resource state_contains(seq&lt;int&gt; L)=this.state() ** tolist(this)==L;
        
    public static inline resource contains(Tree t,seq&lt;int&gt;L)=t-&gt;state() ** L == tolist(t);

    public static boolean sorted_list(seq&lt;int&gt; s)=
      (\forall int i ; 1 &lt; i &amp;&amp; i &lt; |s| ; s[i-1] &lt;= s[i] );
      
    requires t-&gt;state();
    public static boolean sorted(Tree t)=sorted_list(tolist(t));
  @*/

  //@ requires top!=null ** top.state();
  //@ ensures  contains(\result,tail(\old(tolist(top))));
  //@ ensures  \old(sorted(top)) ==&gt; sorted(\result);
  public Tree del_min(Tree top){
    //@ seq&lt;int&gt; orig_contents=tolist(top);
    //@ seq&lt;int&gt; target_contents=tail(tolist(top));
    //@ unfold top.state();
    if (top.left == null) {
      //@ assert orig_contents == tolist(top.left) + seq&lt;int&gt;{top.data} + tolist(top.right);
      //@ assert tolist(top.left) == seq&lt;int&gt;{};
      return top.right;
    } else {
      Tree cur, left;
      cur = top;
      left = top.left;
      //@ seq&lt;int&gt; cur_contents=orig_contents;
      //@ assert cur_contents == tolist(left) + seq&lt;int&gt;{top.data} + tolist(top.right);
      //@ unfold left.state();
      /*@
      loop_invariant Perm(cur.left,write) ** Perm(cur.data,write) ** Perm(cur.right,write);
      loop_invariant cur.left==left ** cur.right-&gt;state() ;
      loop_invariant Perm(left.left,write) ** Perm(left.data,write) ** Perm(left.right,write);
      loop_invariant left.left-&gt;state() ** left.right-&gt;state();
      loop_invariant cur_contents == (tolist(left.left) + seq&lt;int&gt;{left.data} + tolist(left.right))
                                      + seq&lt;int&gt;{cur.data} + tolist(cur.right);
      loop_invariant cur.state_contains(tail(cur_contents)) -* top.state_contains(target_contents); @*/
      while (left.left != null) /*@ with {
        create { qed top.state_contains(target_contents) -* top.state_contains(target_contents); }#\label{proof 1}#
      } @*/
      { /*@ Tree prev = cur;
            seq&lt;int&gt; prev_contents = cur_contents; */
        cur = left;
        left = cur.left;
        /*@
        unfold left.state();
        cur_contents = tolist(left.left) + seq&lt;int&gt;{left.data} + tolist(left.right);
        cur_contents = cur_contents + seq&lt;int&gt;{cur.data} + tolist(cur.right);
        assert prev_contents.length &gt; 0 ;
        assert cur_contents.length &gt; 0 ;
        assert prev_contents == cur_contents + seq&lt;int&gt;{prev.data} + tolist(prev.right);
        create  {#\label{proof 2 begin}#
          use    prev_contents.length &gt; 0 ;
          use    cur_contents.length &gt; 0 ;
          use    Perm(prev.left,write)**Perm(prev.data,write);
          use    Perm(prev.right,write)**prev.right-&gt;state();
          use    prev.left==cur;
          use    prev_contents == cur_contents + seq&lt;int&gt;{prev.data} + tolist(prev.right);
          use    prev.state_contains(tail(prev_contents)) -* top.state_contains(target_contents);
          fold   prev.state();
          assert prev.state_contains(tail(prev_contents));
          apply  prev.state_contains(tail(prev_contents)) -* top.state_contains(target_contents);
          qed    cur.state_contains(tail(cur_contents)) -* top.state_contains(target_contents);
        } #\label{proof 2 end}#
        @*/
      }
      cur.left = left.right;
      //@ fold cur.state();
      //@ assert tolist(cur)==tail(cur_contents);
      //@ assert cur.state_contains(tolist(cur));
      //@ assert cur.state_contains(tail(cur_contents));
      //@ apply  cur.state_contains(tail(cur_contents)) -* top.state_contains(target_contents);
      return top;
    }
  }
}

</textarea>
            <span class="code-buttons">
                <span class="fa fa-times-circle code-close-button"></span>
                <span class="fa fa-play code-run-button"></span>
            </span>
        </div>

        <div style="background-color: #dddddd; padding: 0.4ex 1ex">
            <label class="control-label" for="example-backendid">Language:</label>
            <select name="lang" id="example-backendid" class="form-control">
                
                    <option value="pvl" selected="">PVL</option>
                
                    <option value="java" >Java</option>
                
                    <option value="cu" >Cuda</option>
                
                    <option value="c" >C / OpenMP / OpenCL</option>
                
                    <option value="sil" >Viper</option>
                
            </select>
        </div>
    </div>
    <div class="verification-progress verification-non-plain" style="display: none; background-color: #dddddd; padding: 0.4ex 1ex" >
        <span class="fa"></span>
        <span class="verification-progress-text"></span>
    </div>
    <pre class="verification-log verification-non-plain" style="display: none"></pre>
</div>

    </div>

    </div>
</div>


        <div id="footer">
            <div class="row">
                <a href="//fmt.ewi.utwente.nl" target="_blank"><img src="/images/FMT logo.png" alt=""></a>
                <div class="copyright">
                    <a href="//fmt.ewi.utwente.nl/research/projects/view/vercors/" target="_blank">Copyright <code>&copy</code> The VerCors Project 2007-2022</a>
                    | <a href="//fmt.ewi.utwente.nl" target="_blank">FMT - University of Twente</a>
                    | <a href="/about/">About Us</a>
                </div>
            </div>
        </div>
    </body>
</html>