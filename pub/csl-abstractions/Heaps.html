<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Heaps</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Heaps</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">HahnBase</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Permissions</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PermSolver</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Permutation</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PermutationTactic</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Prelude</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Process</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">QArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Qcanon</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Setoid</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Utf8</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab32"></a><h1 class="section">Heaps</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">Heaps</span>(<span class="id" title="var">dom</span> : <span class="id" title="var">Domains</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Export</span> <span class="id" title="var">dom</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab33"></a><h2 class="section">Ordinary heaps</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Heap</span> := <span class="id" title="var">Val</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">Val</span>.<br/>

<br/>
</div>

<div class="doc">
The <i>identity heap</i> is empty at every location: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hIden</span> : <span class="id" title="var">Heap</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span>.<br/>

<br/>
</div>

<div class="doc">
Update operation for heaps: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hUpdate</span> (<span class="id" title="var">h</span> : <span class="id" title="var">Heap</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">option</span> <span class="id" title="var">Val</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">val_eq_dec</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab34"></a><h3 class="section">Finiteness</h3>

<div class="paragraph"> </div>

 A heap is <i>finite</i> if all mappings that are not free
    can be mapped to some finite structure, in this case a list. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hFinite</span> (<span class="id" title="var">h</span> : <span class="id" title="var">Heap</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Val</span>, <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">h</span> <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">None</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hFinite_iden</span> : <span class="id" title="var">hFinite</span> <span class="id" title="var">hIden</span>.<br/>
 
<br/>
</div>

<div class="doc">
The most important property of finite heaps is that
    one can always find a free entry, as shown below. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hFinite_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">h</span>, <span class="id" title="var">hFinite</span> <span class="id" title="var">h</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">None</span>.<br/>

<br/>
</div>

<div class="doc">
Any heap update preserves finiteness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hFinite_update</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">hFinite</span> <span class="id" title="var">h</span> -&gt; <span class="id" title="var">hFinite</span> (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab35"></a><h2 class="section">Permission heaps cells</h2>

<div class="paragraph"> </div>

 The set <span class="inlinecode"><span class="id" title="var">PermHeapCell</span></span> of <i>permission heap cells</i>
    is later used as the codomain of permission heaps. 
<div class="paragraph"> </div>

 Permission heap cells can be free, invalid or occupied.
    There are three kinds of occupied heap cells, which correspond
    to the three different heap ownership predicates in the logic. 
<div class="paragraph"> </div>

 Notice that <i>action heap cells</i> hold an extra value,
    which is a copy of the value at that heap location,
    made at the moment the action heap cell was created. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">PermHeapCell</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span>(<span class="id" title="var">q</span> : <span class="id" title="var">Qc</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span>(<span class="id" title="var">q</span> : <span class="id" title="var">Qc</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">PHCact</span>(<span class="id" title="var">q</span> : <span class="id" title="var">Qc</span>)(<span class="id" title="var">v</span> <span class="id" title="var">v'</span> : <span class="id" title="var">Val</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PermHeapCell_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PermHeapCell_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PermHeapCell_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PermHeapCell_sind".<br/>

<br/>
</div>

<div class="doc">
<a name="lab36"></a><h3 class="section">Validity</h3>

<div class="paragraph"> </div>

 Any permission heap cell <span class="inlinecode"><span class="id" title="var">phc</span></span> is <i>valid</i> if <span class="inlinecode"><span class="id" title="var">phc</span></span>
    is not (explicitly) invalid, and any underlying
    fractional permission is valid. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcValid</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">perm_valid</span> <span class="id" title="var">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;√ phc" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
Free cells are always valid, whereas invalid cells are never valid. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcValid_free</span> : <span class="id" title="var">phcValid</span> <span class="id" title="var">PHCfree</span>.<br/>
 
<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcValid_contra</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phc</span> &lt;&gt; <span class="id" title="var">PHCinvalid</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phcValid_free</span> <span class="id" title="var">phcValid_contra</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab37"></a><h3 class="section">Disjointness</h3>

<div class="paragraph"> </div>

 Any two permission heap cells are said to be <i>disjoint</i>
    if their underlying fractional permissions are disjoint,
    an all other components are equal apart from that. 
<div class="paragraph"> </div>

 Invalid heap cells are never disjoint with any other heap cell,
    while free heap cells are disjoint with other valid heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcDisj</span> (<span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc1</span>, <span class="id" title="var">phc2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">phc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">phc</span>, <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">perm_disj</span> <span class="id" title="var">q1</span> <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">perm_disj</span> <span class="id" title="var">q1</span> <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span> <span class="id" title="var">v1'</span>, <span class="id" title="var">PHCact</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> <span class="id" title="var">v2'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">perm_disj</span> <span class="id" title="var">q1</span> <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span> /\ <span class="id" title="var">v1'</span> = <span class="id" title="var">v2'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;phc1 ⟂ phc2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
Heap cell disjointness is a symmetric relation 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcDisj_symm</span> : <span class="id" title="var">Symmetric</span> <span class="id" title="var">phcDisj</span>.<br/>

<br/>
</div>

<div class="doc">
Below are the identity laws for disjointness: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_free_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc</span> <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_free_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">PHCfree</span> <span class="id" title="var">phc</span>.<br/>
 
<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phcDisj_free_l</span> <span class="id" title="var">phcDisj_free_r</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Below are some other useful properties of disjointness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_valid_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>, <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_valid_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>, <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span> /\ <span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab38"></a><h3 class="section">Union</h3>

<div class="paragraph"> </div>

 The (disjoint) union of two permission heap cells
    is defined as the addition of their underlying
    fractional permissions. 
<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">PHCfree</span></span> heap cells are neutral with respect to
    disjoint union, while <span class="inlinecode"><span class="id" title="var">PHCinvalid</span></span> are absorbing. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">val_pair_eq_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Val</span> * <span class="id" title="var">Val</span>, {<span class="id" title="var">x</span> = <span class="id" title="var">y</span>} + {<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span>}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcUnion</span> (<span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">PermHeapCell</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc1</span>, <span class="id" title="var">phc2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">phc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">phc</span>, <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">phc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">val_eq_dec</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">PHCstd</span> (<span class="id" title="var">q1</span> + <span class="id" title="var">q2</span>) <span class="id" title="var">v1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">val_eq_dec</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">PHCproc</span> (<span class="id" title="var">q1</span> + <span class="id" title="var">q2</span>) <span class="id" title="var">v1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span> <span class="id" title="var">v1'</span>, <span class="id" title="var">PHCact</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> <span class="id" title="var">v2'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">val_pair_eq_dec</span> (<span class="id" title="var">v1</span>, <span class="id" title="var">v1'</span>) (<span class="id" title="var">v2</span>, <span class="id" title="var">v2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">PHCact</span> (<span class="id" title="var">q1</span> + <span class="id" title="var">q2</span>) <span class="id" title="var">v1</span> <span class="id" title="var">v1'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;phc1 ⨄ phc2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">phcUnion</span></span> relation is associative and commutative. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc1</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phcUnion_assoc</span> <span class="id" title="var">phcUnion_comm</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
The following lemmas show that <span class="inlinecode"><span class="id" title="var">PHCfree</span></span> is neutral for union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_free_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcUnion</span> <span class="id" title="var">phc</span> <span class="id" title="var">PHCfree</span> = <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_free_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcUnion</span> <span class="id" title="var">PHCfree</span> <span class="id" title="var">phc</span> = <span class="id" title="var">phc</span>.<br/>
 
<br/>
<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">phcUnion_free_l</span> <span class="id" title="var">phcUnion_free_r</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Below are various other useful properties of heap cell union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcValid</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_assoc_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_assoc_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_middle</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_swap_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_swap_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc4</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">phc1</span> = <span class="id" title="var">PHCfree</span> /\ <span class="id" title="var">phc2</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcUnion_not_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> &lt;&gt; <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">phc1</span> &lt;&gt; <span class="id" title="var">PHCfree</span> \/ <span class="id" title="var">phc2</span> &lt;&gt; <span class="id" title="var">PHCfree</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab39"></a><h3 class="section">Orderings</h3>

<div class="paragraph"> </div>

 The following (strict) partial order defines the
    'less than' relation on permission heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcLt</span> (<span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc1</span>, <span class="id" title="var">phc2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt; <span class="id" title="var">q1</span> &lt; <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span> <span class="id" title="var">v1'</span>, <span class="id" title="var">PHCact</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> <span class="id" title="var">v2'</span> =&gt; <span class="id" title="var">q1</span> &lt; <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span> /\ <span class="id" title="var">v1'</span> = <span class="id" title="var">v2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;phc1 ≺ phc2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">phcLt</span></span> relation is a strict partial order
    (i.e., irreflexive, asymmetric and transitive).  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLt_irrefl</span> : <span class="id" title="var">Irreflexive</span> <span class="id" title="var">phcLt</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLt_trans</span> : <span class="id" title="var">Transitive</span> <span class="id" title="var">phcLt</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLt_asymm</span> : <span class="id" title="var">Asymmetric</span> <span class="id" title="var">phcLt</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLt_strictorder</span> : <span class="id" title="var">StrictOrder</span> <span class="id" title="var">phcLt</span>.<br/>
 
<br/>
</div>

<div class="doc">
Below are several other useful properties of <span class="inlinecode"><span class="id" title="var">phcLt</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_mono_pos</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">PHCfree</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_mono_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_mono_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_diff</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">phc3</span>, <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> /\ <span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> = <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_lt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
</div>

<div class="doc">
The following partial order defines the 'less than or equal to'
    relation on permission heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcLe</span> (<span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc1</span>, <span class="id" title="var">phc2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> =&gt; <span class="id" title="var">q1</span> &lt;= <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q1</span> <span class="id" title="var">v1</span> <span class="id" title="var">v1'</span>, <span class="id" title="var">PHCact</span> <span class="id" title="var">q2</span> <span class="id" title="var">v2</span> <span class="id" title="var">v2'</span> =&gt; <span class="id" title="var">q1</span> &lt;= <span class="id" title="var">q2</span> /\ <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span> /\ <span class="id" title="var">v1'</span> = <span class="id" title="var">v2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span>, <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;phc1 ≼ phc2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">phcLe</span></span> relation is a non-strict partial order. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLe_refl</span> : <span class="id" title="var">Reflexive</span> <span class="id" title="var">phcLe</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phcLe_refl</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_le_weak</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_lt_or_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phc1</span> = <span class="id" title="var">phc2</span> \/ <span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLe_antisym</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Antisymmetric</span> <span class="id" title="var">PermHeapCell</span> <span class="id" title="var">eq</span> <span class="id" title="var">phcLe</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLe_trans</span> : <span class="id" title="var">Transitive</span> <span class="id" title="var">phcLe</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLe_preorder</span> : <span class="id" title="var">PreOrder</span> <span class="id" title="var">phcLe</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phcLe_partialorder</span> : <span class="id" title="var">PartialOrder</span> <span class="id" title="var">eq</span> <span class="id" title="var">phcLe</span>.<br/>

<br/>
</div>

<div class="doc">
Below are various other useful properties of <span class="inlinecode"><span class="id" title="var">phcLe</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcLe</span> <span class="id" title="var">PHCfree</span> <span class="id" title="var">phc</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_lt_trans</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_le_trans</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_weaken</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_weaken</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_mono_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_mono_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_mono_pos</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_diff</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">phc3</span>, <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> /\ <span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> = <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_le</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab40"></a><h3 class="section">Entirety</h3>

<div class="paragraph"> </div>

 Any permission heap cell <span class="inlinecode"><span class="id" title="var">phc</span></span> is said to be <i>entire</i>
    if <span class="inlinecode"><span class="id" title="var">phc</span></span> is occupied and holds a fractional permission <span class="inlinecode"><span class="id" title="var">perm_full</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcEntire</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">q</span> = <span class="id" title="var">perm_full</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcEntire_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcEntire_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcEntire_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> \/ <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcEntire_lt_neg</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt; ~ <span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcEntire_le</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_entire_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phc1</span> = <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcDisj_entire_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt; <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt; <span class="id" title="var">phc2</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_entire_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phcLt</span> <span class="id" title="var">PHCfree</span> <span class="id" title="var">phc</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab41"></a><h3 class="section">Concretisation</h3>

<div class="paragraph"> </div>

 The <i>concretisation</i> of any permission heap cell <span class="inlinecode"><span class="id" title="var">phc</span></span>
    is the underlying value of <span class="inlinecode"><span class="id" title="var">phc</span></span> (thus removing all structure
    related to the context of the heap cell). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Val</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">_</span> <span class="id" title="var">v</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_lt_none</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_le_none</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_lt_some</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_le_some</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_none_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc</span> = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) = <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_disj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) = <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_disj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc1</span>) = <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab42"></a><h3 class="section">Snapshots</h3>

<div class="paragraph"> </div>

 The following operation extracts the <i>snapshot value</i>
    out of a given permission heap cell. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Val</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>  =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">_</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Below are several useful properties of snapshot extraction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConcr_snapshot_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_disj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span>) = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_disj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc1</span>) = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc3</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_lt_none</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_le_none</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_lt_some</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_le_some</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc2</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab43"></a><h3 class="section">Heap cell conversion</h3>

<div class="paragraph"> </div>

 Below are three operations for converting the
    type of permission heap cells, named
    <span class="inlinecode"><span class="id" title="var">phcConvStd</span></span>, for converting to standard heap cells;
    <span class="inlinecode"><span class="id" title="var">phcConvProc</span></span>, for converting to process heap cells;
    and <span class="inlinecode"><span class="id" title="var">phcConvAct</span></span>, for converting to action heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcConvStd</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">PermHeapCell</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;'std' { phc }" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcConvProc</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">PermHeapCell</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;'proc' { phc }" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phcConvAct</span> (<span class="id" title="var">phc</span> : <span class="id" title="var">PermHeapCell</span>) : <span class="id" title="var">PermHeapCell</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">phc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCfree</span> =&gt; <span class="id" title="var">PHCfree</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span> =&gt; <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PHCinvalid</span> =&gt; <span class="id" title="var">PHCinvalid</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;'act' { phc }" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
</div>

<div class="doc">
Converting any heap cell to its original types does not
    have any effect. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phc_std_conv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>, <span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> = <span class="id" title="var">phcConvStd</span> (<span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phc_proc_conv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>, <span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> = <span class="id" title="var">phcConvProc</span> (<span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phc_act_conv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>, <span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> = <span class="id" title="var">phcConvAct</span> (<span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>).<br/>
 
<br/>
</div>

<div class="doc">
Heap cell conversion is idempotent. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvStd</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvProc</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvAct</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>.<br/>
 
<br/>
</div>

<div class="doc">
Free heap cells always convert to free heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvStd</span> <span class="id" title="var">PHCfree</span> = <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvProc</span> <span class="id" title="var">PHCfree</span> = <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvAct</span> <span class="id" title="var">PHCfree</span> = <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCfree</span>.<br/>
 
<br/>
</div>

<div class="doc">
Invalid heap cells always convert to invalid heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_invalid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvStd</span> <span class="id" title="var">PHCinvalid</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_invalid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvProc</span> <span class="id" title="var">PHCinvalid</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_invalid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvAct</span> <span class="id" title="var">PHCinvalid</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_invalid2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_invalid2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_invalid2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span> &lt;-&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">PHCinvalid</span>.<br/>
 
<br/>
</div>

<div class="doc">
Heap cell conversion preserves validity. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> &lt;-&gt; <span class="id" title="var">phcValid</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> &lt;-&gt; <span class="id" title="var">phcValid</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> &lt;-&gt; <span class="id" title="var">phcValid</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>).<br/>
 
<br/>
</div>

<div class="doc">
Heap cell conversion preserves disjointness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phcConvStd</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phcDisj</span> ==&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phcConvStd_disj</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phcConvProc</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phcDisj</span> ==&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phcConvProc_disj</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phcConvAct</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phcDisj</span> ==&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phcConvAct_disj</span>.<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion preserves entirety. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcEntire</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> <span class="id" title="var">phc</span>.<br/>
 
<br/>
</div>

<div class="doc">
Below are several other properties of heap cell conversion
    for later convenience. 
<div class="paragraph"> </div>

 Note: in the following three lemmas, the validity condition
    is not neccessary for the right-to-left implication. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_conv_std_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_conv_proc_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLt_conv_act_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_conv_std_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_conv_proc_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">PHCproc</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcLe_conv_act_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">PHCact</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span>) <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>) <span class="id" title="var">phc3</span> &lt;-&gt; <span class="id" title="var">phcDisj</span> <span class="id" title="var">phc2</span> <span class="id" title="var">phc3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc1</span>) <span class="id" title="var">phc2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc1</span>) <span class="id" title="var">phc2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> <span class="id" title="var">phc1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc1</span>) <span class="id" title="var">phc2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvStd</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvProc</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcConvAct</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_lt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_lt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_lt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_le</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_le</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_le</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcValid</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLe</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvProc_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvAct_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>, <span class="id" title="var">phcConcr</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">phcConcr</span> <span class="id" title="var">phc</span>.<br/>
 
<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_conv_proc_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc</span>) &lt;&gt; <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_conv_act_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>) &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_lt_conv_std</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc1</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_lt_conv_proc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvProc</span> <span class="id" title="var">phc1</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_lt_conv_act</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> <span class="id" title="var">phc1</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc1</span> = <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc1</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcSnapshot_conv_act_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phc</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">phcConvAct</span> <span class="id" title="var">phc</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
</div>

<div class="doc">
Note: the following lemmas does not hold
    for process or action heap cell conversion. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phcConvStd_lt_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcLt</span> (<span class="id" title="var">PHCstd</span> <span class="id" title="var">q</span> <span class="id" title="var">v</span>) <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phc</span> = <span class="id" title="var">phcConvStd</span> <span class="id" title="var">phc</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab44"></a><h2 class="section">Permission heaps</h2>

<div class="paragraph"> </div>

 Permission heaps are defined as (total) mappings
    from values to permission heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">PermHeap</span> := <span class="id" title="var">Val</span> -&gt; <span class="id" title="var">PermHeapCell</span>.<br/>

<br/>
</div>

<div class="doc">
The identity permission heap is free at every location 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phIden</span> : <span class="id" title="var">PermHeap</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">PHCfree</span>.<br/>

<br/>
</div>

<div class="doc">
An update operation for process maps: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phUpdate</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)(<span class="id" title="var">c</span> : <span class="id" title="var">PermHeapCell</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">val_eq_dec</span> <span class="id" title="var">ph</span> <span class="id" title="var">v</span> <span class="id" title="var">c</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab45"></a><h3 class="section">Validity</h3>

<div class="paragraph"> </div>

 Any permission heap <span class="inlinecode"><span class="id" title="var">ph</span></span> is defined to be <i>valid</i>
    if every entry of <span class="inlinecode"><span class="id" title="var">ph</span></span> is valid. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phValid</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">phcValid</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;√ ph" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
The identity permission heap is valid. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phValid_iden</span> : <span class="id" title="var">phValid</span> <span class="id" title="var">phIden</span>.<br/>
 
<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phValid_iden</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Updating a valid permission heap with a valid entry
    results in a valid permission heap. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phValid_update</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">phc</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="var">phcValid</span> <span class="id" title="var">phc</span> -&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab46"></a><h3 class="section">Disjointness</h3>

<div class="paragraph"> </div>

 Any two permission heaps are said to be <i>disjoint</i>
    if all their entries are pairwise disjoint. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phDisj</span> : <span class="id" title="var">relation</span> <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">pointwise_relation</span> <span class="id" title="var">Val</span> <span class="id" title="var">phcDisj</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;ph1 ⟂ ph2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
Permission heap disjointness is symmeric. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">phDisj_symm</span> : <span class="id" title="var">Symmetric</span> <span class="id" title="var">phDisj</span>.<br/>
 
<br/>
</div>

<div class="doc">
Permission heap disjointness implies validity. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_valid_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>, <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phValid</span> <span class="id" title="var">ph1</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_valid_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>, <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phValid</span> <span class="id" title="var">ph2</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>, <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phValid</span> <span class="id" title="var">ph1</span> /\ <span class="id" title="var">phValid</span> <span class="id" title="var">ph2</span>.<br/>

<br/>
</div>

<div class="doc">
Any valid permission heap is disjoint
    with the identity permission heap. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_iden_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="var">phDisj</span> <span class="id" title="var">ph</span> <span class="id" title="var">phIden</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_iden_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="var">phDisj</span> <span class="id" title="var">phIden</span> <span class="id" title="var">ph</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phDisj_iden_l</span> <span class="id" title="var">phDisj_iden_r</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Updating disjoint permission heaps with entries
    that are disjoint preserves heap disjointness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_upd</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcDisj</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phUpdate</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">phcDisj</span> ==&gt; <span class="id" title="var">phDisj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phDisj_upd_mor</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab47"></a><h3 class="section">Union</h3>

<div class="paragraph"> </div>

 The (disjoint) union of two permission heaps is defined
    to be the pairwise disjoint union of their heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phUnion</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> : <span class="id" title="var">PermHeap</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">phcUnion</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">ph2</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;ph1 ⨄ ph2" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
</div>

<div class="doc">
Identity laws for disjoint union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_iden_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phUnion</span> <span class="id" title="var">ph</span> <span class="id" title="var">phIden</span> = <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_iden_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phUnion</span> <span class="id" title="var">phIden</span> <span class="id" title="var">ph</span> = <span class="id" title="var">ph</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">phUnion_iden_l</span> <span class="id" title="var">phUnion_iden_r</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Disjoint union is associative and commutative. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">ph3</span> = <span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>, <span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> = <span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph1</span>.<br/>

<br/>
</div>

<div class="doc">
The union of any two disjoint permission heaps is valid. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>).<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">phUnion_valid</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
Below are various other useful properties of disjoint union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_assoc_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_assoc_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">ph3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_update</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phUpdate</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">l</span> (<span class="id" title="var">phcUnion</span> <span class="id" title="var">phc1</span> <span class="id" title="var">phc2</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span> <span class="id" title="var">phc1</span>) (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span> <span class="id" title="var">phc2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_cell</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcUnion</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">ph2</span> <span class="id" title="var">l</span>) = <span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>.<br/>
 
<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_middle</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phDisj_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>) (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_swap_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_swap_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">ph3</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>) <span class="id" title="var">ph2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>) (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph4</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph4</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phUnion_update_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">phc</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">ph2</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>) <span class="id" title="var">ph2</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUpdate</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">l</span> <span class="id" title="var">phc</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab48"></a><h3 class="section">Concretisation</h3>

<div class="paragraph"> </div>

 The <i>concretisation</i> of a permission heap <span class="inlinecode"><span class="id" title="var">ph</span></span>
    is the heap that contains the concretisations
    of all heap cells of <span class="inlinecode"><span class="id" title="var">ph</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phConcr</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>) : <span class="id" title="var">Heap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">phcConcr</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConcr_update</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">hUpdate</span> (<span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>) <span class="id" title="var">l</span> (<span class="id" title="var">phcConcr</span> <span class="id" title="var">phc</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConcr_disj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> <span class="id" title="var">ph1</span> = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>) = <span class="id" title="var">phConcr</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConcr_disj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> <span class="id" title="var">ph1</span> = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph1</span>) = <span class="id" title="var">phConcr</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab49"></a><h3 class="section">Snapshot</h3>

<div class="paragraph"> </div>

 The <i>snapshot</i> of any permission heap <span class="inlinecode"><span class="id" title="var">ph</span></span> is the
    heap constructed from the snapshots of all <span class="inlinecode"><span class="id" title="var">ph</span></span>s entries. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phSnapshot</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>) : <span class="id" title="var">Heap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">phcSnapshot</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Several useful properties of permission heap snapshots: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phSnapshot_upd</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">hUpdate</span> (<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span>) <span class="id" title="var">l</span> (<span class="id" title="var">phcSnapshot</span> <span class="id" title="var">phc</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phSnapshot_disj_union_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph1</span> = <span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span>) = <span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phSnapshot_disj_union_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph2</span> <span class="id" title="var">ph3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph1</span> = <span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph1</span>) = <span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph3</span> <span class="id" title="var">ph2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab50"></a><h3 class="section">Finiteness</h3>

<div class="paragraph"> </div>

 A permission heap is <i>finite</i> if all mappings that are
    not free can be mapped to some finite structure,
    in this case a list. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phFinite</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Val</span>, <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">ph</span> <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">PHCfree</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span>.<br/>

<br/>
</div>

<div class="doc">
The main property of interest of finite permission heaps,
    is that one can always find a mapping that is free. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phFinite_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phFinite</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
</div>

<div class="doc">
Finiteness is preserved by any heap updates. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phFinite_update</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phFinite</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="var">phFinite</span> (<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">phc</span>).<br/>

<br/>
</div>

<div class="doc">
The disjoint union of two finite permission heaps is finite. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phFinite_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phFinite</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) &lt;-&gt; <span class="id" title="var">phFinite</span> <span class="id" title="var">ph1</span> /\ <span class="id" title="var">phFinite</span> <span class="id" title="var">ph2</span>.<br/>

<br/>
</div>

<div class="doc">
Permission heap concretisation preserves finiteness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phFinite_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> -&gt; <span class="id" title="var">phFinite</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">hFinite</span> (<span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab51"></a><h3 class="section">Heap cell conversion</h3>

<div class="paragraph"> </div>

 This section discusses tools to convert the types
    of heap cells in permission heaps. 
<div class="paragraph"> </div>

 The operations <span class="inlinecode"><span class="id" title="var">permheap_conv_std</span></span>, <span class="inlinecode"><span class="id" title="var">permheap_conv_proc</span></span>,
    and <span class="inlinecode"><span class="id" title="var">permheap_conv_act</span></span> are
    used to convert the heap cell at location <span class="inlinecode"><span class="id" title="var">l</span></span> in a given
    permission heap <span class="inlinecode"><span class="id" title="var">ph</span></span> to a <i>standard</i>,
    <i>process</i>, or <i>action</i> heap cell, respectively.
    Later we define similar operations that work
    on sequences of heap locations. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phConvStd</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> (<span class="id" title="var">phcConvStd</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phConvProc</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> (<span class="id" title="var">phcConvProc</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phConvAct</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">phUpdate</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> (<span class="id" title="var">phcConvAct</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>)).<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;'std' { ph ',' l }" := (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'proc' { ph ',' l }" := (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'act' { ph ',' l }" := (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion is idempotent. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvStd</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l</span> = <span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvProc</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l</span> = <span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvAct</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l</span> = <span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion preserves validity. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion preserves disjointness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvStd</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">phDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phConvStd_disj</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvProc</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">phDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phConvProc_disj</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvAct</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">phDisj</span> <span class="id" title="keyword">as</span> <span class="id" title="var">phConvAct_disj</span>.<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion preserves entirety. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l'</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l'</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l'</span>).<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion preserves concretisations. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>

<br/>
</div>

<div class="doc">
Heap cell conversion distributes over disjoint union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStd</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">l</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProc</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">l</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvAct</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">l</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Free heap cells always convert to free heap cells. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> -&gt; <span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> -&gt; <span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> -&gt; <span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">ph</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
</div>

<div class="doc">
Any heap cell that is not converted stays the same. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>, <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>, <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>, <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>

<br/>
</div>

<div class="doc">
Requesting any converted heap cell gives the converted heap cell. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvStd</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvProc</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvAct</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
 
<br/>
</div>

<div class="doc">
Below are various other useful properties of heap cell conversion. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStd_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvStd</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) <span class="id" title="var">ph2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) <span class="id" title="var">ph2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) -&gt; <span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph1</span> <span class="id" title="var">l</span>) <span class="id" title="var">ph2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProc_snapshot_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_snapshot_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvAct_snapshot_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l'</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab52"></a><h3 class="section">Heap cell batch conversions</h3>

<div class="paragraph"> </div>

 The following operations are for converting a sequence
    (or set) of heap locations (i.e., for converting a
    batch or bulk of locations). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">phConvStdMult</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ph</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">l</span> :: <span class="id" title="var">xs'</span> =&gt; <span class="id" title="var">phConvStd</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">phConvProcMult</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ph</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">l</span> :: <span class="id" title="var">xs'</span> =&gt; <span class="id" title="var">phConvProc</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">phConvActMult</span> (<span class="id" title="var">ph</span> : <span class="id" title="var">PermHeap</span>)(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Val</span>) : <span class="id" title="var">PermHeap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ph</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">l</span> :: <span class="id" title="var">xs'</span> =&gt; <span class="id" title="var">phConvAct</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs'</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;'std' { ph ';' xs }" := (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'proc' { ph ';' xs }" := (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'act' { ph ';' xs }" := (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>

<br/>
</div>

<div class="doc">
Converting an empty batch of locations leaves the heap unchanged. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_nil</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">ph</span> = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">nil</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_nil</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">ph</span> = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">nil</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_nil</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span>, <span class="id" title="var">ph</span> = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">nil</span>.<br/>
 
<br/>
</div>

<div class="doc">
Properties related to converting a single heap cell: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_single</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvStd</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> [<span class="id" title="var">l</span>].<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_single</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvProc</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> [<span class="id" title="var">l</span>].<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_single</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>, <span class="id" title="var">phConvAct</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> [<span class="id" title="var">l</span>].<br/>
 
<br/>
</div>

<div class="doc">
Conversions of a non-empty batch of locations can be unfolded. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvStd</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvProc</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span>.<br/>
 <span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvAct</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span>.<br/>
 
<br/>
</div>

<div class="doc">
Conversion of two batches of locations can be appended
    into a single batch. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_app</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">xs</span> ++ <span class="id" title="var">ys</span>) = <span class="id" title="var">phConvStdMult</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>) <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_app</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">xs</span> ++ <span class="id" title="var">ys</span>) = <span class="id" title="var">phConvProcMult</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>) <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_app</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">xs</span> ++ <span class="id" title="var">ys</span>) = <span class="id" title="var">phConvActMult</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>) <span class="id" title="var">xs</span>.<br/>

<br/>
</div>

<div class="doc">
Batch conversions are closed under permutations. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_permut</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">Permutation</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> -&gt; <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_permut</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">Permutation</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> -&gt; <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_permut</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">Permutation</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> -&gt; <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">ys</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvStdMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvStdMult_permut_mor</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvProcMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvProcMult_permut_mor</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvActMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvActMult_permut_mor</span>.<br/>
 
<br/>
</div>

<div class="doc">
Batch conversions are idempotent. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">xs</span> = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">xs</span> = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_idemp</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">xs</span> = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>

<br/>
</div>

<div class="doc">
Any duplicate conversions in a batch are subsumed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_subsume</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_subsume</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_subsume</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> (<span class="id" title="var">l</span> :: <span class="id" title="var">xs</span>) = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>.<br/>

<br/>
</div>

<div class="doc">
Batch conversions preserve heap validity. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_valid</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phValid</span> <span class="id" title="var">ph</span> &lt;-&gt; <span class="id" title="var">phValid</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>).<br/>

<br/>
</div>

<div class="doc">
Converting a batch of only free locations does not change the heap. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_free</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> = <span class="id" title="var">ph</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_free2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span> &lt;-&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">PHCfree</span>.<br/>

<br/>
</div>

<div class="doc">
Batch conversions preserve heap disjointness. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_disj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt; <span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvStdMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">phDisj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvStdMult_disj_mor</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvProcMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">phDisj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvProcMult_disj_mor</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">phConvActMult</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">phDisj</span> ==&gt; @<span class="id" title="var">Permutation</span> <span class="id" title="var">Val</span> ==&gt; <span class="id" title="var">phDisj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">phConvActMult_disj_mor</span>.<br/>

<br/>
</div>

<div class="doc">
Batch conversions preserve entirety. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_entire</span>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_entire</span>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_entire</span>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phcEntire</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>) &lt;-&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Batch conversions distribute over disjoint union. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvStdMult</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">xs</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvProcMult</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">xs</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_union</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phConvActMult</span> (<span class="id" title="var">phUnion</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>) <span class="id" title="var">xs</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">phUnion</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph2</span> <span class="id" title="var">xs</span>).<br/>

<br/>
</div>

<div class="doc">
Batch conversions preserve heap concretisation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_concr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span>, <span class="id" title="var">phConcr</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) = <span class="id" title="var">phConcr</span> <span class="id" title="var">ph</span>.<br/>

<br/>
</div>

<div class="doc">
Any location that is not in the conversion batch
    is not affected by batch conversion. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
Any location in the conversion batch is indeed converted. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvStd</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvProc</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_apply</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> <span class="id" title="var">ph</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span> <span class="id" title="var">l</span> = <span class="id" title="var">phcConvAct</span> (<span class="id" title="var">ph</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
Batch conversions preserve occupied snapshots. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_snapshot_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_snapshot_occ</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_snapshot_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> <span class="id" title="var">ph</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phSnapshot</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph</span> <span class="id" title="var">xs</span>) <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span>.<br/>

<br/>
</div>

<div class="doc">
Below are various other useful properties of batch conversions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvStdMult_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvStdMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) <span class="id" title="var">ph2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvProcMult_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvProcMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) <span class="id" title="var">ph2</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">phConvActMult_disj_entire</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">In</span> <span class="id" title="var">l</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">phcEntire</span> (<span class="id" title="var">ph1</span> <span class="id" title="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> <span class="id" title="var">ph1</span> <span class="id" title="var">ph2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">phDisj</span> (<span class="id" title="var">phConvActMult</span> <span class="id" title="var">ph1</span> <span class="id" title="var">xs</span>) <span class="id" title="var">ph2</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Heaps</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>